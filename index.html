<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro del Automotor 09001 (Clorinda)</title>
    <style>
        :root { --primary: #0056b3; --success: #28a745; --error: #dc3545; --warning: #ffc107; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; background: #e9ecef; }
        .card { background: white; padding: 2.5rem; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 450px; text-align: center; }
        h1 { color: #333; font-size: 1.5rem; margin-bottom: 1.5rem; border-bottom: 2px solid var(--primary); padding-bottom: 10px; }
        label { display: block; text-align: left; margin-bottom: 5px; font-weight: bold; color: #555; }
        select, input { width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-size: 1rem; }
        input#dominio { text-transform: uppercase; font-weight: bold; letter-spacing: 2px; text-align: center; font-size: 1.4rem; border: 2px solid var(--primary); }
        button { width: 100%; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: bold; transition: 0.3s; background: var(--primary); color: white; }
        button:hover { background: #004494; }
        #resultado { margin-top: 20px; padding: 15px; border-radius: 6px; display: none; line-height: 1.4; font-weight: 500; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeeba; border: 2px solid orange; }
    </style>
</head>
<body>

<div class="card">
    <h1>Registro del Automotor 09001 (Clorinda)</h1>
    
    <label for="tipoVehiculo">Seleccione Categoría</label>
    <select id="tipoVehiculo" onchange="actualizarPlaceholder()">
        <option value="auto">Automóvil</option>
        <option value="moto">Motocicleta</option>
        <option value="fabrica">Automóvil (Defecto de Fábrica)</option>
    </select>

    <label for="dominio">Dominio (Patente)</label>
    <input type="text" id="dominio" placeholder="Ej: ABC123" oninput="validarFormato(this)">
    
    <button onclick="consultar()">CONSULTAR ESTADO</button>

    <div id="resultado"></div>
</div>

<script>
    function actualizarPlaceholder() {
        const tipo = document.getElementById('tipoVehiculo').value;
        const dominioInput = document.getElementById('dominio');
        dominioInput.value = "";
        document.getElementById('resultado').style.display = 'none';
        
        // Como "por defecto de fabrica" son autos, usamos el mismo placeholder de auto
        if (tipo === 'auto' || tipo === 'por defecto de fabrica') {
            dominioInput.placeholder = "123ABC o AB123AB";
        } else if (tipo === 'moto') {
            dominioInput.placeholder = "ABC123 o A123AAA";
        }
    }

    function validarFormato(input) {
        // Elimina símbolos y espacios
        input.value = input.value.replace(/[^a-zA-Z0-9]/g, '').toUpperCase();
        input.maxLength = 7;
    }

    async function consultar() {
        const dominio = document.getElementById('dominio').value.trim();
        const tipo = document.getElementById('tipoVehiculo').value;
        const resDiv = document.getElementById('resultado');
        
        // Máscaras de Argentina
        const regexAuto = /^(?:\d{3}[A-Z]{3}|[A-Z]{2}\d{3}[A-Z]{2})$/; 
        const regexMoto = /^(?:[A-Z]{3}\d{3}|[A-Z]\d{3}[A-Z]{3})$/; 

        if(!dominio) { 
            alert("Por favor, ingrese un dominio."); 
            return; 
        }

        // Validación: Si es 'auto' O 'por defecto de fabrica', usamos la máscara de auto
        let formatoValido = true;
        if (tipo === 'auto' || tipo === 'por defecto de fabrica') {
            formatoValido = regexAuto.test(dominio);
        } else if (tipo === 'moto') {
            formatoValido = regexMoto.test(dominio);
        }

        if (!formatoValido) {
            resDiv.style.display = 'block';
            resDiv.innerHTML = `⚠️ Formato de patente no válido para la categoría seleccionada.`;
            resDiv.className = "warning";
            return;
        }
        
        resDiv.style.display = 'block';
        resDiv.innerHTML = "Buscando en el registro...";
        resDiv.className = "";

        try {
            const response = await fetch('https://visebas1.app.n8n.cloud/webhook/consulta-patente', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ dominio: dominio, tipo: tipo })
            });

            const data = await response.json();
            resDiv.innerHTML = data.mensaje;
            
            const mensajeBajo = data.mensaje.toLowerCase();
            if (mensajeBajo.includes("ya llegó")) {
                resDiv.className = "success";
            } else if (mensajeBajo.includes("no se encuentra")) {
                resDiv.className = "warning";
            } else {
                resDiv.className = "error";
            }

        } catch (error) {
            resDiv.innerHTML = "Error de conexión con el registro.";
            resDiv.className = "error";
        }
    }

    document.getElementById('dominio').addEventListener('keypress', (e) => { if (e.key === 'Enter') consultar(); });
</script>

</body>
</html>